"use strict";var ApplicationConfiguration={applicationModuleName:"visplayer",applicationModuleVendorDependencies:["ngResource","ngAnimate","ngCookies","ngTouch","ngSanitize","ui.router","ui.bootstrap","ui.utils","angularFileUpload"],registerModule:function(e,i){angular.module(e,i||[]),angular.module("visplayer").requires.push(e)}};angular.module(ApplicationConfiguration.applicationModuleName,ApplicationConfiguration.applicationModuleVendorDependencies),angular.module(ApplicationConfiguration.applicationModuleName).config(["$locationProvider",function(e){e.hashPrefix("!")}]),angular.element(document).ready(function(){"#_=_"===window.location.hash&&(window.location.hash="#!"),"#"===window.location.href[window.location.href.length-1]&&window.location.href.length-window.location.origin.length==2&&(window.location.href=window.location.origin+"/#!"),angular.bootstrap(document,[ApplicationConfiguration.applicationModuleName])}),ApplicationConfiguration.registerModule("core"),ApplicationConfiguration.registerModule("slides"),ApplicationConfiguration.registerModule("users"),angular.module("core").constant("FileTypes",{models:["vis","ply","obj"]}),angular.module("core").run(["Menus",function(e){e.addMenuItem("topbar","vis3D","slides/edit")}]),angular.module("core").config(["$stateProvider","$urlRouterProvider",function(e,i){i.otherwise("/"),e.state("home",{url:"/",templateUrl:"modules/core/views/home.client.view.html"})}]),angular.module("core").controller("HeaderController",["$rootScope","$scope","Authentication","Menus",function(e,i,t,o){i.authentication=t,i.isCollapsed=!1,i.menu=o.getMenu("topbar"),i.toggleCollapsibleMenu=function(){i.isCollapsed=!i.isCollapsed},i.changeMode=function(i){e.mode=i.title,e.$broadcast("mode.change")},i.$on("$stateChangeSuccess",function(){i.isCollapsed=!1})}]),angular.module("core").controller("HomeController",["$rootScope","$scope","Authentication","Languages",function(e,i,t,o){i.authentication=t}]),angular.module("core").controller("TranslateController",["$rootScope","$window","$scope","$log","Scene","Languages",function(e,i,t,o,n,s){t.enablePicking=!0,t.language=s.localization(),n.selectType=n.GEOMETRY_TYPES.model,n.selectMode=n.SELECTION_MODES.single,n.displaySelect=!1,t.mode="translate",t.x=0,t.y=0,t.z=0;var l,r=[];t.onUndo=function(){if(1===r.length){let e=r[0];l.copy(e,!1)}else if(r.length>1){let e=r.pop();l.matrix.equals(e.matrix)?t.onUndo():l.copy(e,!1)}},t.onOK=function(){t.onApply(),l.data.matrixWorld=l.matrixWorld,n.viewClear(),n.clearSelection(),n.deleteTransformer(),e.$broadcast("dialog.close")},t.onApply=function(){void 0!==l&&(l.translateX(t.x),l.translateY(t.y),l.translateZ(t.z))},t.onCancel=function(){n.viewClear(),n.clearSelection(),n.deleteTransformer(),r.length>0&&(l.copy(r[0],!1),r=[]),e.$broadcast("dialog.close")},t.$on("scene.transformer.update",function(e){e.preventDefault(),r.push(l.clone())}),t.$on("scene.selected",function(e,i){e.preventDefault(),n.createTransformer(t.mode,i[0])&&(l=i[0],r.push(i[0].clone()))})}]),angular.module("core").controller("UploadController",["$rootScope","$scope","$log","$modalInstance","Files",function(e,i,t,o,n){i.files=[],i.names=[],i.collect=function(e){void 0===e||e.length<=0||(i.names=[],e.forEach(function(e){i.names.push(e.name)}))},i.$watch("files",function(){i.collect(i.files)}),i.upload=function(){i.files.length>0&&n.upload(i.files,null,function(i){e.$broadcast("upload.success",i.file.name)},null,function(e,t){e.length===i.files.length?o.dismiss("success"):o.dismiss("failed")})}}]),angular.module("core").service("Dialogs",["$window","$modal",function(e,i){this.upload=function(){return i.open({templateUrl:"modules/core/views/upload.client.view.html",controller:"UploadController",size:"sm"})},this.translate=function(){return"modules/core/views/translate.client.view.html"}}]),angular.module("core").service("Files",["$resource","$http","$window","$log","$upload","Authentication",function(e,i,t,o,n,s){var l=e("files/:fileName",{fileName:"@fileName"},{update:{method:"PUT"}});this.decryptData=function(e,i){var o=JSON.parse(e),n=t.CryptoJS.lib.CipherParams.create({ciphertext:t.CryptoJS.enc.Hex.parse(o.ciphertext)}),s=t.CryptoJS.enc.Hex.parse(o.salt),l=t.CryptoJS.EvpKDF(i,s,{keySize:4}),r=t.CryptoJS.enc.Hex.parse(o.iv);t.CryptoJS.AES.decrypt(n,l,{iv:r,mode:t.CryptoJS.mode.CBC}).toString(t.CryptoJS.enc.Utf8)},this.upload=function(e,i,t,s,l){if(!(void 0===e||e.length<=0)){var r=[],a=[];e.forEach(function(d,c){function u(){c===e.length-1&&l&&l(r,a)}n.upload({url:"/upload",file:d}).progress(function(e){var t=(e.loaded/e.total*100).toFixed();o.log("progress: "+t+"% "+e.config.file.name),i&&i(t)}).success(function(e,i,n,s){r.push(s.file.name),o.info("%s is uploaded successfully.",s.file.name),t&&t(s),u()}).error(function(e,i,t,n){a.push(n.file.name),o.error("Failed to upload %s.",n.file.name),s&&s(n),u()})})}},this.list=function(e){l.query(function(i,t){e&&e(i)})},this.download=function(e,t,o){void 0===e||e.length<=0||e.forEach(function(e){var n="files/"+e;i.get(n,{params:{mode:"download"},responseType:"blob"}).success(function(i,o,n,s){i&&t&&t(i,e)}).error(function(e,i,t,n){o&&o(i)})})},this.load=function(e,i,n,s){void 0===e||e.length<=0||e.forEach(function(l){var r=new t.XMLHttpRequest;r.addEventListener("progress",function(e){var t=r.getResponseHeader("ContentLength"),n=(e.loaded/t*100).toFixed();o.log("progress: "+n+"% "+l),i&&i(n)},!1),r.addEventListener("load",function(e){o.info("%s is loaded successfully.",l),n&&n(r.response)},!1),r.addEventListener("error",function(i){o.error("Failed to load %s.",e),s&&s(i)},!1),r.open("get","files/"+l,!0),r.send()})},this.delete=function(e,i,t){void 0===e||e.length<=0||e.forEach(function(e){l.delete({fileName:e},function(t,n){o.info("%s is deleted successfully.",e),i&&i(e)},function(i){o.error("Failed to delete %s!",e),t&&t(e)})})}}]),angular.module("core").service("Languages",[function(){this.code="eng",this.localization=function(e){switch(void 0!==e&&(this.code=e),this.code){case"eng":return{sidebar:{files:"List of files",scene:"List of scene objects",modeling:"List of modeling tools"},files:{upload:"Upload files to server",download:"Download files from server",load:"Load files into scene",delete:"Delete files from server"},scene:{snapshot:"Take a snapshot of scene",delete:"Delete objects from scene"},modeling:{createBox:"Create Box",serialize:"Serialize",viewFit:"Fit view",viewTop:"Top view",viewBottom:"Bottom view",viewLeft:"Left view",viewRight:"Right view",viewFront:"Front view",viewBack:"Back view",viewClear:"Clear view",pickModel:"Pick model",pickFace:"Pick face",pickEdge:"Pick edge",pickCurve:"Pick curve",pickPoint:"Pick point",displayShaded:"Shaded display",displayRendered:"Rendered display",displayAnalysis:"Analysis display",displayMesh:"Mesh display",displayWireframe:"Wireframe display",translate:"Translate model"},dialogTranslate:{pickModel:"Pick a model",x:"x value",y:"y value",z:"z value",ok:"OK",cancel:"Cancel"}};default:return}}}]),angular.module("core").service("Menus",[function(){this.defaultRoles=["*"],this.menus={};var e=function(e){if(!e)return this.isPublic;if(~this.roles.indexOf("*"))return!0;for(var i in e.roles)for(var t in this.roles)if(this.roles[t]===e.roles[i])return!0;return!1};this.validateMenuExistance=function(e){if(e&&e.length){if(this.menus[e])return!0;throw new Error("Menu does not exists")}throw new Error("MenuId was not provided")},this.getMenu=function(e){return this.validateMenuExistance(e),this.menus[e]},this.addMenu=function(i,t,o){return this.menus[i]={isPublic:t||!1,roles:o||this.defaultRoles,items:[],shouldRender:e},this.menus[i]},this.removeMenu=function(e){this.validateMenuExistance(e),delete this.menus[e]},this.addMenuItem=function(i,t,o,n,s,l,r,a){return this.validateMenuExistance(i),this.menus[i].items.push({title:t,link:o,menuItemType:n||"item",menuItemClass:n,uiRoute:s||"/"+o,isPublic:null===l||void 0===l?this.menus[i].isPublic:l,roles:null===r||void 0===r?this.menus[i].roles:r,position:a||0,items:[],shouldRender:e}),this.menus[i]},this.addSubMenuItem=function(i,t,o,n,s,l,r,a){this.validateMenuExistance(i);for(var d in this.menus[i].items)this.menus[i].items[d].link===t&&this.menus[i].items[d].items.push({title:o,link:n,uiRoute:s||"/"+n,isPublic:null===l||void 0===l?this.menus[i].items[d].isPublic:l,roles:null===r||void 0===r?this.menus[i].items[d].roles:r,position:a||0,shouldRender:e});return this.menus[i]},this.removeMenuItem=function(e,i){this.validateMenuExistance(e);for(var t in this.menus[e].items)this.menus[e].items[t].link===i&&this.menus[e].items.splice(t,1);return this.menus[e]},this.removeSubMenuItem=function(e,i){this.validateMenuExistance(e);for(var t in this.menus[e].items)for(var o in this.menus[e].items[t].items)this.menus[e].items[t].items[o].link===i&&this.menus[e].items[t].items.splice(o,1);return this.menus[e]},this.addMenu("topbar")}]),angular.module("core").service("Scene",["$rootScope","$window","$document","$log",function(e,i,t,o){function n(){j.aspect=i.innerWidth/i.innerHeight,j.updateProjectionMatrix(),B.setSize(i.innerWidth,i.innerHeight)}function s(e){e.preventDefault(),0===e.button&&P.selectType>0&&w()}function l(e){e.preventDefault(),oe.x=e.clientX/window.innerWidth*2-1,oe.y=-e.clientY/window.innerHeight*2+1}function r(e){e.preventDefault()}function a(e){return e/180*Math.PI}function d(){let e=new i.THREE.Scene;Q.push(e),z=e;let t=new i.THREE.Scene;ee.push(t),N=t}function c(e){if(!(e instanceof i.THREE.Scene))return;let t=0;e.box=new i.THREE.Box3,e.traverse(function(o){if(void 0!==o.type&&o.type===P.GEOMETRY_TYPES.model){let n=new i.THREE.Box3;n.setFromObject(o),e.box.union(n),t++}}),0===t&&e.box.makeEmpty(),e.center=new i.THREE.Vector3,t>0&&e.center.copy(e.box.min).add(e.box.max).multiplyScalar(.5)}function u(){_=t[0].getElementById("canvases"),B=i.WebGLRenderingContext?new i.THREE.WebGLRenderer({alpha:!0,antialias:!0,preserveDrawingBuffer:!0}):new i.THREE.CanvasRenderer,(U=B.domElement).id="canvas3d",B.setSize(i.innerWidth,i.innerHeight),B.setPixelRatio(i.devicePixelRatio),B.autoClear=!0,_.appendChild(U),(V=t[0].createElement("canvas")).id="canvas2d",V.width=i.innerWidth,V.height=i.innerHeight,V.style.width=i.innerWidth.toString()+"px",V.style.height=i.innerHeight.toString()+"px",V.style.pointerEvents="none",_.appendChild(V),(G=V.getContext("2d")).paint=function(e){G.clearRect(0,0,i.innerWidth,i.innerHeight),e.children.forEach(function(e){e.paint(G)})}}function f(){let e=new i.THREE.PerspectiveCamera(D,i.innerWidth/i.innerHeight,O,$);e.name="VIEW #"+Z.length+1,e.position.set(2*-H,2*-H,H),e.up.copy(new i.THREE.Vector3(0,0,1)),e.target=new i.THREE.Vector3,Z.push(e),j=e}function m(){let e=new i.THREE.GridHelper(H,C);e.name="GRID",e.rotateX(Math.PI/2),z.add(e);let t=new i.THREE.AxisHelper(H);t.name="AXIS",z.add(t),(q=new i.THREE.ACSHelper(j,150,i.innerHeight-50,50)).name="ACS",N.add(q)}function p(){(W=new i.THREE.DirectionalLight(16777215,.5)).name="EYE LIGHT",W.position.set(2*H,H,2*H),z.add(W)}function h(){if(void 0===J)if(1===ie){let e=new i.THREE.TrackballControls(j);e.rotateSpeed=4,e.zoomSpeed=2,e.panSpeed=1,e.noZoom=!1,e.noPan=!1,e.staticMoving=!0,e.dynamicDampingFactor=.3,J=e}else if(2===ie){let e=new i.THREE.OrbitControls(j,U);J=e}}function v(e){if(void 0===e)return 0;let i=0;return z.traverse(function(t){t.type===P.GEOMETRY_TYPES.model&&t.name===e&&i++}),i}function g(){let e=L,i=A,t=!0,o=!0;switch(P.displayMode){case P.DISPLAY_MODES.shaded:break;case P.DISPLAY_MODES.rendered:o=!1;break;case P.DISPLAY_MODES.analysis:e=Y;break;case P.DISPLAY_MODES.mesh:e=F;break;case P.DISPLAY_MODES.wireframe:t=!1}return{meshMaterial:e,meshVisibility:t,lineMaterial:i,lineVisibility:o}}function E(e,t){e instanceof i.THREE.Scene||(e.selected=t),void 0!==e.children&&e.children.length>0&&e.children.forEach(function(e){E(e,t)})}function w(){X.setFromCamera(oe,j);let i=X.intersectObjects(z.children,!0);if(i.length>0){let e,t=[];if(P.selectType&P.GEOMETRY_TYPES.model&&void 0!==(e=T(i))&&t.push(e),void 0===e&&P.selectType&P.GEOMETRY_TYPES.face&&void 0!==(e=y(i))&&t.push(e),void 0===e&&P.selectType&P.GEOMETRY_TYPES.edge&&void 0!==(e=S(i))&&t.push(e),void 0===e&&P.selectType&P.GEOMETRY_TYPES.curve&&void 0!==(e=M(i))&&t.push(e),void 0===e&&P.selectType&P.GEOMETRY_TYPES.point&&void 0!==(e=R(i))&&t.push(e),0===t.length)return;t.forEach(function(e){if(P.selectMode===P.SELECTION_MODES.single&&(te.forEach(function(e){E(e,!1)}),te=[]),te.length>0&&-1!==te.indexOf(e)){let i=te.indexOf(e);te.splice(i,1),E(e,!1)}else E(e,!0),te.push(e)})}P.displaySelect&&P.updateDisplays(),te.length>0&&e.$broadcast("scene.selected",te)}function T(e){if(0!==e.length)for(ne=0;ne<e.length;ne++)if(e[ne].object instanceof i.THREE.Mesh){let i=e[ne].object.parent.parent;if(void 0!==i.type&&i.type===P.GEOMETRY_TYPES.model)return i}}function y(e){if(0!==e.length)for(ne=0;ne<e.length;ne++)if(e[ne].object instanceof i.THREE.Mesh){let i=e[ne].object;if(void 0!==i.type&&i.type===P.GEOMETRY_TYPES.face)return i}}function S(e){if(0!==e.length)for(ne=0;ne<e.length;ne++)if(e[ne].object instanceof i.THREE.Line){let i=e[ne].object;if(void 0!==i.type&&i.type===P.GEOMETRY_TYPES.edge)return i}}function M(e){if(0!==e.length)for(ne=0;ne<e.length;ne++)if(e[ne].object instanceof i.THREE.Line){let i=e[ne].object;if(void 0!==i.type&&i.type===P.GEOMETRY_TYPES.curve)return i}}function R(e){if(0!==e.length)for(ne=0;ne<e.length;ne++)if(e[ne].object instanceof i.THREE.Vector3){let i=e[ne].object;if(void 0!==i.type&&i.type===P.GEOMETRY_TYPES.point)return i}}function b(){i.requestAnimationFrame(b),x(),k()}function k(){B.render(z,j),G.paint(N)}function x(){void 0!==q&&q.update(),void 0!==J&&J.update(),void 0!==K&&K.update();let e=new i.THREE.Vector3;e.copy(j.position).sub(j.target).normalize(),W.position.copy(e)}function I(e,t,o,n){let s=new i.THREE.BoxGeometry(e,t,o),l=new i.THREE.MeshBasicMaterial({color:void 0!==n?n:16777215,wireframe:!0}),r=new i.THREE.Mesh(s,l);var a=(new Date).getUTCMilliseconds();return r.name="BOX "+a,r}var P=this,H=2e3,C=100,D=45,O=.1,$=10*H;P.GEOMETRY_TYPES={model:1,face:2,edge:4,curve:8,point:16},P.SELECTION_MODES={single:0,multiple:1},P.selectType=0,P.selectMode=P.SELECTION_MODES.multiple,P.displaySelect=!0;var L=new i.THREE.MeshStandardMaterial({color:13553358,transparent:!0,opacity:.8,emissive:0,side:i.THREE.DoubleSide}),Y=new i.THREE.MeshNormalMaterial({side:i.THREE.DoubleSide}),F=new i.THREE.MeshBasicMaterial({wireframe:!0}),A=(new i.THREE.MeshBasicMaterial({transparent:!0,opacity:.8,reflectivity:.5,envMap:(new i.THREE.CubeTextureLoader).setPath("modules/core/images/cube/").load(["posx.jpg","negx.jpg","posy.jpg","negy.jpg","posz.jpg","negz.jpg"]),combine:i.THREE.MixOperation,side:i.THREE.DoubleSide}),new i.THREE.LineBasicMaterial({color:3355443}));P.DISPLAY_MODES={shaded:1,rendered:2,analysis:3,mesh:4,wireframe:5},P.displayMode=P.DISPLAY_MODES.shaded;var _,B,U,V,G,j,z,N,W,q,J,X,K,Z=[],Q=[],ee=[],ie=2,te=[],oe=new i.THREE.Vector2,ne=0,se=0;P.initialize=function(){i.Detector.webgl?(u(),f(),d(),m(),p(),h(),X=new i.THREE.Raycaster,i.addEventListener("resize",n,!1),U.addEventListener("mousedown",s,!1),U.addEventListener("mousemove",l,!1),U.addEventListener("mouseup",r,!1),b()):i.Detector.addGetWebGLMessage()},P.queryModels=function(e){let i=[];z.traverse(function(e){e.type===P.GEOMETRY_TYPES.model&&i.push(e.name)}),e&&e(i)},P.loadModel=function(e,t){if(void 0===e)return;let o=g(),n=v(e.name)+1;var s=new i.THREE.Object3D;s.data=e,s.name=e.name,s.displayName=s.name+" #"+n,s.type=P.GEOMETRY_TYPES.model,s.box=new i.THREE.Box3;let l=new i.THREE.Object3D;l.name="faces",s.add(l);let r=new i.THREE.Object3D;for(r.name="edges",s.add(r),ne=0;ne<e.meshes.length;ne++){let t=e.meshes[ne];if("surfaceMesh"===t.type){let e=new i.THREE.Geometry;for(se=0;se<t.nodes.count;se++)e.vertices.push(new i.THREE.Vector3(t.nodes.points[3*se],t.nodes.points[3*se+1],t.nodes.points[3*se+2]));for(se=0;se<t.facets.count;se++){let o=t.facets.indices[3*se],n=t.facets.indices[3*se+1],s=t.facets.indices[3*se+2],l=new i.THREE.Face3(o,n,s);l.vertexNormals=[new i.THREE.Vector3(t.nodes.normals[3*o],t.nodes.normals[3*o+1],t.nodes.normals[3*o+2]),new i.THREE.Vector3(t.nodes.normals[3*n],t.nodes.normals[3*n+1],t.nodes.normals[3*n+2]),new i.THREE.Vector3(t.nodes.normals[3*s],t.nodes.normals[3*s+1],t.nodes.normals[3*s+2])],e.faces.push(l)}e.key=t.id,e.computeFaceNormals(),e.computeBoundingBox(),s.box.union(e.boundingBox);let n=new i.THREE.Mesh(e,o.meshMaterial.clone());n.savedMaterial=n.material,n.visible=o.meshVisibility,n.type=P.GEOMETRY_TYPES.face,n.selected=!1,l.add(n)}else if("curveMesh"===t.type&&3===t.cardinal){let e=new i.THREE.Geometry;for(se=0;se<t.nodes.count;se++)e.vertices.push(new i.THREE.Vector3(t.nodes.points[3*se],t.nodes.points[3*se+1],t.nodes.points[3*se+2]));e.key=t.id,e.computeBoundingBox();let n=new i.THREE.Line(e,o.lineMaterial.clone());n.savedMaterial=n.material,n.visible=o.lineVisibility,n.type=P.GEOMETRY_TYPES.edge,n.selected=!1,r.add(n)}}s.center=new i.THREE.Vector3,s.center.copy(s.box.min).add(s.box.max).multiplyScalar(.5),s.children.forEach(function(e){e.children.forEach(function(e){e.geometry.translate(-s.center.x,-s.center.y,-s.center.z)})}),s.position.copy(s.center),z.add(s),P.viewFit(),t&&t(s)},P.removeObject=function(e){if(void 0===e)return;let i=0;z.children.forEach(function(t){t.displayName!==e?i++:z.children.splice(i,1)})},P.updateDisplays=function(e){if(void 0===e)P.updateDisplays(z);else{if("Scene"!==e.constructor.name&&"Mesh"!==e.constructor.name&&"Line"!==e.constructor.name&&"Object3D"!==e.constructor.name)return;if(void 0!==e.children&&e.children.length>0&&e.children.forEach(function(e){P.updateDisplays(e)}),void 0!==e.material){let t=g();e instanceof i.THREE.Mesh?(e.material=t.meshMaterial.clone(),e.savedMaterial=t.meshMaterial.clone(),e.visible=t.meshVisibility):e instanceof i.THREE.Line&&(e.material=t.lineMaterial.clone(),e.savedMaterial=t.lineMaterial.clone(),e.visible=t.lineVisibility),e.visible&&e.selected&&void 0!==e.material.color&&e.material.color.setHex(13238519)}}},P.viewClear=function(){E(z,!1),te=[],P.updateDisplays()},P.clearSelection=function(){P.selectType=0,P.selectMode=P.SELECTION_MODES.multiple,P.displaySelect=!0},P.viewFit=function(e){if(c(z),z.box.isEmpty())return;let t=new i.THREE.Vector3;void 0!==e?t.copy(e):t.copy(j.position).sub(z.center).normalize();let o=z.box.getBoundingSphere().radius/Math.sin(a(D/2));t.multiplyScalar(o);let n=new i.THREE.Vector3;n.copy(z.center).add(t),j.position.copy(n),j.lookAt(z.center),J.target.copy(z.center)},P.viewTop=function(){P.viewFit(new i.THREE.Vector3(0,0,1)),j.up.copy(new i.THREE.Vector3(0,1,0))},P.viewBottom=function(){P.viewFit(new i.THREE.Vector3(0,0,-1)),j.up.copy(new i.THREE.Vector3(0,-1,0))},P.viewLeft=function(){P.viewFit(new i.THREE.Vector3(-1,0,0)),j.up.copy(new i.THREE.Vector3(0,0,1))},P.viewRight=function(){P.viewFit(new i.THREE.Vector3(1,0,0)),j.up.copy(new i.THREE.Vector3(0,0,1))},P.viewFront=function(){P.viewFit(new i.THREE.Vector3(0,-1,0)),j.up.copy(new i.THREE.Vector3(0,0,1))},P.viewBack=function(){P.viewFit(new i.THREE.Vector3(0,1,0)),j.up.copy(new i.THREE.Vector3(0,0,1))},P.createTransformer=function(t,o){return void 0===K&&((K=new i.THREE.TransformControls(j,U)).setMode(t),K.addEventListener("change",k),K.addEventListener("mouseUp",function(i){e.$broadcast("scene.transformer.update")}),z.add(K),void 0!==o&&K.attach(o),!0)},P.switchTransformer=function(e){void 0!==K&&K.setMode(e)},P.deleteTransformer=function(){void 0!==K&&(K.detach(),z.remove(K),K=void 0)},P.createBox=function(){let e=I(300,300,300,16711680);z.add(e)},P.serialize=function(){}}]),angular.module("core").service("Tools",["$log",function(e){this.defaultRoles=["*"],this.tools={};var i=function(e){if(!e)return this.isPublic;if(~this.roles.indexOf("*"))return!0;for(var i in e.roles)for(var t in this.roles)if(this.roles[t]===e.roles[i])return!0;return!1};this.validateToolExistance=function(i){return!(i&&i.length&&!this.tools[i])||(e.error("Tree does not exists"),!1)},this.getTool=function(e){if(this.validateToolExistance(e))return this.tools[e]},this.addTool=function(e,t,o){return this.tools[e]={isPublic:t||!1,roles:o||this.defaultRoles,items:[],shouldRender:i},this.tools[e]},this.removeTool=function(e){this.validateToolExistance(e)&&delete this.tools[e]},this.addToolItem=function(e,t,o,n,s,l,r,a,d,c){if(this.validateToolExistance(e))return this.tools[e].items.push({title:t,icon:o,link:n||l,uiRoute:"/"+n,toggle:s,action:l,tooltip:r,isPublic:null===a||void 0===a?this.tools[e].isPublic:a,roles:null===d||void 0===d?this.tools[e].roles:d,position:c||0,items:[],shouldRender:i}),this.tools[e]},this.removeToolItem=function(e,i){if(this.validateToolExistance(e)){for(var t in this.tools[e].items)this.tools[e].items[t].link===i&&this.tools[e].items.splice(t,1);return this.tools[e]}}}]),angular.module("core").service("Trees",["$log",function(e){this.defaultRoles=["*"],this.trees={};var i=function(e){if(!e)return this.isPublic;if(~this.roles.indexOf("*"))return!0;for(var i in e.roles)for(var t in this.roles)if(this.roles[t]===e.roles[i])return!0;return!1};this.validateTreeExistance=function(i){return!(i&&i.length&&!this.trees[i])||(e.error("Tree does not exists"),!1)},this.getTree=function(e){if(this.validateTreeExistance(e))return this.trees[e]},this.addTree=function(e,t,o){return this.trees[e]={isPublic:t||!1,roles:o||this.defaultRoles,items:[],shouldRender:i},this.trees[e]},this.emptyTree=function(e){if(this.validateTreeExistance(e))for(var i in this.trees[e].items)this.trees[e].items[i].items=[]},this.removeTree=function(e){this.validateTreeExistance(e)&&delete this.trees[e]},this.validateTreeItemExistance=function(i,t){if(t&&t.length)for(var o in this.trees[i].items)if(this.trees[i].items[o].link===t)return e.error("Tree item is already existant"),!1;return!0},this.addTreeItem=function(e,t,o,n,s,l){if(this.validateTreeExistance(e)&&this.validateTreeItemExistance(e,n))return this.trees[e].items.push({title:t,icon:o,link:n,isPublic:null===s||void 0===s?this.trees[e].isPublic:s,roles:null===l||void 0===l?this.trees[e].roles:l,items:[],checked:!1,shouldRender:i}),this.trees[e]},this.removeTreeItem=function(e,i){if(this.validateTreeExistance(e)){for(var t in this.trees[e].items)this.trees[e].items[t].link===i&&this.trees[e].items.splice(t,1);return this.trees[e]}},this.validateSubTreeItemExistance=function(i,t,o){if(o&&o.length)for(var n in this.trees[i].items)if(this.trees[i].items[n].link===t)for(var s in this.trees[i].items[n].items)if(this.trees[i].items[n].items[s].link===o)return e.error("Sub tree item is already existant"),!1;return!0},this.addSubTreeItem=function(e,t,o,n,s,l,r){if(this.validateTreeExistance(e)&&this.validateTreeItemExistance(e,s)&&this.validateSubTreeItemExistance(e,t,s)){for(var a in this.trees[e].items)this.trees[e].items[a].link===t&&this.trees[e].items[a].items.push({title:o,icon:n,link:s,isPublic:null===l||void 0===l?this.trees[e].items[a].isPublic:l,roles:null===r||void 0===r?this.trees[e].items[a].roles:r,checked:!1,shouldRender:i});return this.trees[e]}},this.removeSubTreeItem=function(e,i){if(this.validateTreeExistance(e)){for(var t in this.trees[e].items)for(var o in this.trees[e].items[t].items)this.trees[e].items[t].items[o].link===i&&this.trees[e].items[t].items.splice(o,1);return this.trees[e]}},this.checkAllSubTreeItems=function(e,i,t){if(this.validateTreeExistance(e))for(var o in this.trees[e].items)if(this.trees[e].items[o].link===i){var n=this.trees[e].items[o];if(void 0!==n.items&&n.items.length>0)for(var s in n.items)n.items[s].checked=t}},this.getCheckedSubTreeItems=function(e){if(this.validateTreeExistance(e)){var i=[];for(var t in this.trees[e].items)for(var o in this.trees[e].items[t].items)this.trees[e].items[t].items[o].checked&&i.push(this.trees[e].items[t].items[o]);return i}}}]),angular.module("slides").run(["$rootScope","Menus","Tools","Trees","Dialogs","Languages",function(e,i,t,o,n,s){s.code="eng",e.language=s.localization(),void 0===e.language&&(e.language=s.localization("eng"));var l=e.language;t.addTool("sidebar"),t.addTool("files"),t.addTool("scene"),t.addTool("modeling"),t.addToolItem("sidebar","files","icon-files","slides/edit/files",void 0,void 0,l.sidebar.files),t.addToolItem("sidebar","scene","icon-scenes","slides/edit/scene",void 0,void 0,l.sidebar.scene),t.addToolItem("sidebar","modeling","icon-tools","slides/edit/modeling",void 0,void 0,l.sidebar.modeling),t.addToolItem("files","upload","icon-upload",void 0,void 0,"uploadFiles",l.files.upload),t.addToolItem("files","download","icon-download",void 0,void 0,"downloadFiles",l.files.download),t.addToolItem("files","load","icon-load",void 0,void 0,"loadFiles",l.files.load),t.addToolItem("files","delete","icon-delete",void 0,void 0,"deleteFiles",l.files.delete),t.addToolItem("scene","snapshot","icon-snapshot",void 0,void 0,"takeSnapshot",l.scene.snapshot),t.addToolItem("scene","delete","icon-delete",void 0,void 0,"removeObjects",l.scene.delete),t.addToolItem("modeling","createBox","icon-box",void 0,void 0,"createBox",l.modeling.createBox),t.addToolItem("modeling","serialize","icon-serialize",void 0,void 0,"serialize",l.modeling.serialize),t.addToolItem("modeling","viewFit","icon-view-fit",void 0,void 0,"viewFit",l.modeling.viewFit),t.addToolItem("modeling","viewTop","icon-view-top",void 0,void 0,"viewTop",l.modeling.viewTop),t.addToolItem("modeling","viewBottom","icon-view-bottom",void 0,void 0,"viewBottom",l.modeling.viewBottom),t.addToolItem("modeling","viewLeft","icon-view-left",void 0,void 0,"viewLeft",l.modeling.viewLeft),t.addToolItem("modeling","viewRight","icon-view-right",void 0,void 0,"viewRight",l.modeling.viewRight),t.addToolItem("modeling","viewFront","icon-view-front",void 0,void 0,"viewFront",l.modeling.viewFront),t.addToolItem("modeling","viewBack","icon-view-back",void 0,void 0,"viewBack",l.modeling.viewBack),t.addToolItem("modeling","viewClear","icon-pick-nothing",void 0,void 0,"viewClear",l.modeling.viewClear),t.addToolItem("modeling","pickModel","icon-pick-model",void 0,!1,"pickModel",l.modeling.pickModel),t.addToolItem("modeling","pickFace","icon-pick-face",void 0,!1,"pickFace",l.modeling.pickFace),t.addToolItem("modeling","pickEdge","icon-pick-edge",void 0,!1,"pickEdge",l.modeling.pickEdge),t.addToolItem("modeling","pickCurve","icon-pick-curve",void 0,!1,"pickCurve",l.modeling.pickCurve),t.addToolItem("modeling","pickPoint","icon-pick-point",void 0,!1,"pickPoint",l.modeling.pickPoint),t.addToolItem("modeling","displayShaded","icon-display-shaded",void 0,void 0,"displayShaded",l.modeling.displayShaded),t.addToolItem("modeling","displayRendered","icon-display-rendered",void 0,void 0,"displayRendered",l.modeling.displayRendered),t.addToolItem("modeling","displayAnalysis","icon-display-analysis",void 0,void 0,"displayAnalysis",l.modeling.displayAnalysis),t.addToolItem("modeling","displayMesh","icon-display-mesh",void 0,void 0,"displayMesh",l.modeling.displayMesh),t.addToolItem("modeling","displayWireframe","icon-display-wireframe",void 0,void 0,"displayWireframe",l.modeling.displayWireframe),t.addToolItem("modeling","translate","icon-translate",void 0,void 0,"translate",l.modeling.translate),o.addTree("scene"),o.addTree("files"),o.addTreeItem("files","Models","icon-file","models"),o.addTreeItem("scene","Models","icon-file","models")}]),angular.module("slides").factory("httpResponseInterceptor",["$q",function(e){return{response:function(i){return i||e.when(i)}}}]).config(["$httpProvider",function(e){e.interceptors.push("httpResponseInterceptor")}]),angular.module("slides").config(["$stateProvider",function(e){e.state("editSlide",{url:"/slides/edit",templateUrl:"modules/slides/views/edit-slide.client.view.html"}).state("editSlide.Files",{url:"/files",templateUrl:"modules/slides/views/edit-slide-files.client.view.html"}).state("editSlide.Scene",{url:"/scene",templateUrl:"modules/slides/views/edit-slide-scene.client.view.html"}).state("editSlide.Modeling",{url:"/modeling",templateUrl:"modules/slides/views/edit-slide-modeling.client.view.html"})}]),angular.module("slides").controller("SlidesController",["$rootScope","$scope","$stateParams","$location","$window","$document","$log","$controller","$upload","Authentication","Scene","Files","Tools","Trees","Dialogs","FileTypes","Slides",function(e,i,t,o,n,s,l,r,a,d,c,u,f,m,p,h,v){function g(e){var i=[];return m.getCheckedSubTreeItems(e).forEach(function(e){i.push(e.title)}),i}function E(e){return-1!==h.models.indexOf(e)?"icon-file-model":"icon-file-text"}function w(e){var i=e.split(".").reverse()[0],t=E(i);-1!==h.models.indexOf(i)?m.addSubTreeItem("files","models",e,t,e):m.addSubTreeItem("files","others",e,t,e)}function T(e,i){var t=s[0].getElementById("download");t.href=e,t.download=i,t.click()}function y(e){m.addSubTreeItem("scene","models",e,"icon-file-model",e)}function S(e,i,t){e?c.selectType+=i:c.selectType-=i,c.selectMode=t}function M(){i.modelingTools.items.forEach(function(e){void 0!==e.toggle&&(e.toggle=!1)}),c.viewClear()}i.authentication=d,i.link=void 0,i.showPanel=!1,i.modal=void 0,i.dialogUrl=void 0,i.lock=!1,i.sidebarTools=f.getTool("sidebar"),i.fileTools=f.getTool("files"),i.sceneTools=f.getTool("scene"),i.modelingTools=f.getTool("modeling"),m.emptyTree("files"),i.fileTree=m.getTree("files"),u.list(function(e){e&&e.length>0&&e.forEach(function(e){w(e.toLowerCase())})}),c.initialize(),m.emptyTree("scene"),i.sceneTree=m.getTree("scene"),c.queryModels(function(e){e.forEach(function(e){y(e)})}),i.activatePanel=function(e){void 0===i.link||e!==i.link?(i.showPanel=!0,i.link=e,o.url(e)):i.showPanel=!i.showPanel},i.activateTool=function(e){void 0!==e.toggle?i.lock||(e.toggle=!e.toggle,void 0!==e.action&&i[e.action](e)):void 0!==e.action&&i[e.action]()},i.checkItem=function(e,i){i.checked=!i.checked,m.checkAllSubTreeItems(e,i.link,i.checked)},i.isCheckDisabled=function(e){return 0===e.items.length&&(e.checked=!1,!0)},i.takeSnapshot=function(){T(s[0].getElementById("canvas").children[0].toDataURL("image/png"),"screenshot.png")},i.removeObjects=function(){g("scene").forEach(function(e){c.removeObject(e),m.removeSubTreeItem("scene",e)})},i.uploadFiles=function(){void 0===i.dialogUrl&&(i.modal=p.upload())},i.downloadFiles=function(){var e=g("files");u.download(e,function(e,i){var t=new n.Blob([e]);T((n.URL||n.webkitURL).createObjectURL(t),i)})},i.loadFiles=function(){var e=g("files");u.load(e,null,function(e){var i=JSON.parse(e);c.loadModel(i,function(e){y(e.displayName.toLowerCase())})})},i.deleteFiles=function(){var e=g("files");u.delete(e,function(e){m.removeSubTreeItem("files",e)},function(e){n.alert("Failed to delete: "+e)})},i.createBox=c.createBox,i.serialize=c.serialize,i.viewFit=c.viewFit,i.viewTop=c.viewTop,i.viewBottom=c.viewBottom,i.viewLeft=c.viewLeft,i.viewRight=c.viewRight,i.viewFront=c.viewFront,i.viewBack=c.viewBack,i.viewClear=c.viewClear,i.pickModel=function(e){S(e.toggle,c.GEOMETRY_TYPES.model,c.SELECTION_MODES.multiple)},i.pickFace=function(e){S(e.toggle,c.GEOMETRY_TYPES.face,c.SELECTION_MODES.multiple)},i.pickEdge=function(e){S(e.toggle,c.GEOMETRY_TYPES.edge,c.SELECTION_MODES.multiple)},i.pickCurve=function(e){S(e.toggle,c.GEOMETRY_TYPES.curve,c.SELECTION_MODES.multiple)},i.pickPoint=function(e){S(e.toggle,c.GEOMETRY_TYPES.point,c.SELECTION_MODES.multiple)},i.displayShaded=function(){c.displayMode=c.DISPLAY_MODES.shaded,c.updateDisplays()},i.displayRendered=function(){c.displayMode=c.DISPLAY_MODES.rendered,c.updateDisplays()},i.displayAnalysis=function(){c.displayMode=c.DISPLAY_MODES.analysis,c.updateDisplays()},i.displayMesh=function(){c.displayMode=c.DISPLAY_MODES.mesh,c.updateDisplays()},i.displayWireframe=function(){c.displayMode=c.DISPLAY_MODES.wireframe,c.updateDisplays()},i.translate=function(){M(),i.dialogUrl=p.translate(),i.lock=!0},i.create=function(){new v({name:this.name}).$save(function(e){o.path("slides/"+e._id),i.name=""},function(e){i.error=e.data.message})},i.remove=function(e){if(e){e.$remove();for(var t in i.slides)i.slides[t]===e&&i.slides.splice(t,1)}else i.slide.$remove(function(){o.path("slides")})},i.update=function(){var e=i.slide;e.$update(function(){o.path("slides/"+e._id)},function(e){i.error=e.data.message})},i.find=function(){i.slides=v.query()},i.findOne=function(){i.slide=v.get({slideId:t.slideId})},i.$on("mode.change",function(e){i.showPanel=!1}),i.$on("upload.success",function(e,i){e.preventDefault(),w(i)}),i.$on("dialog.close",function(e){e.preventDefault(),i.dialogUrl=void 0,i.lock=!1})}]),angular.module("slides").factory("Slides",["$resource",function(e){return e("slides/:slideId",{slideId:"@_id"},{update:{method:"PUT"}})}]),angular.module("users").config(["$httpProvider",function(e){e.interceptors.push(["$q","$location","Authentication",function(e,i,t){return{responseError:function(o){switch(o.status){case 401:t.user=null,i.path("signin")}return e.reject(o)}}}])}]),angular.module("users").config(["$stateProvider",function(e){e.state("profile",{url:"/settings/profile",templateUrl:"modules/users/views/settings/edit-profile.client.view.html"}).state("password",{url:"/settings/password",templateUrl:"modules/users/views/settings/change-password.client.view.html"}).state("signup",{url:"/signup",templateUrl:"modules/users/views/authentication/signup.client.view.html"}).state("signin",{url:"/signin",templateUrl:"modules/users/views/authentication/signin.client.view.html"}).state("forgot",{url:"/password/forgot",templateUrl:"modules/users/views/password/forgot-password.client.view.html"}).state("reset-invalid",{url:"/password/reset/invalid",templateUrl:"modules/users/views/password/reset-password-invalid.client.view.html"}).state("reset-success",{url:"/password/reset/success",templateUrl:"modules/users/views/password/reset-password-success.client.view.html"}).state("reset",{url:"/password/reset/:token",templateUrl:"modules/users/views/password/reset-password.client.view.html"})}]),angular.module("users").controller("AuthenticationController",["$scope","$http","$location","Authentication",function(e,i,t,o){e.authentication=o,e.authentication.user&&t.path("/"),e.signup=function(){i.post("/auth/signup",e.credentials).success(function(i){e.authentication.user=i,t.path("/slides/edit")}).error(function(i){e.error=i.message})},e.signin=function(){i.post("/auth/signin",e.credentials).success(function(i){e.authentication.user=i,t.path("/slides/edit")}).error(function(i){e.error=i.message})}}]),angular.module("users").controller("PasswordController",["$scope","$stateParams","$http","$location","Authentication",function(e,i,t,o,n){e.authentication=n,e.authentication.user&&o.path("/"),e.askForPasswordReset=function(){e.success=e.error=null,t.post("/auth/forgot",e.credentials).success(function(i){e.credentials=null,e.success=i.message}).error(function(i){e.credentials=null,e.error=i.message})},e.resetUserPassword=function(){e.success=e.error=null,t.post("/auth/reset/"+i.token,e.passwordDetails).success(function(i){e.passwordDetails=null,n.user=i,o.path("/password/reset/success")}).error(function(i){e.error=i.message})}}]),angular.module("users").controller("SettingsController",["$scope","$http","$location","Users","Authentication",function(e,i,t,o,n){e.user=n.user,e.user||t.path("/"),e.hasConnectedAdditionalSocialAccounts=function(i){for(var t in e.user.additionalProvidersData)return!0;return!1},e.isConnectedSocialAccount=function(i){return e.user.provider===i||e.user.additionalProvidersData&&e.user.additionalProvidersData[i]},e.removeUserSocialAccount=function(t){e.success=e.error=null,i.delete("/users/accounts",{params:{provider:t}}).success(function(i){e.success=!0,e.user=n.user=i}).error(function(i){e.error=i.message})},e.updateUserProfile=function(i){i?(e.success=e.error=null,new o(e.user).$update(function(i){e.success=!0,n.user=i},function(i){e.error=i.data.message})):e.submitted=!0},e.changeUserPassword=function(){e.success=e.error=null,i.post("/users/password",e.passwordDetails).success(function(i){e.success=!0,e.passwordDetails=null}).error(function(i){e.error=i.message})}}]),angular.module("users").factory("Authentication",["$window",function(e){return{user:e.user}}]),angular.module("users").factory("Users",["$resource",function(e){return e("users",{},{update:{method:"PUT"}})}]);