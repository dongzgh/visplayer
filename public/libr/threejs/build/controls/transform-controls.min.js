(function(){var c=function(c){THREE.MeshBasicMaterial.call(this);this.depthWrite=this.depthTest=!1;this.side=THREE.FrontSide;this.transparent=!0;this.setValues(c);this.oldColor=this.color.clone();this.oldOpacity=this.opacity;this.highlight=function(a){a?(this.color.setRGB(1,1,0),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};c.prototype=Object.create(THREE.MeshBasicMaterial.prototype);c.prototype.constructor=c;var m=function(c){THREE.LineBasicMaterial.call(this);this.depthWrite=
this.depthTest=!1;this.transparent=!0;this.linewidth=1;this.setValues(c);this.oldColor=this.color.clone();this.oldOpacity=this.opacity;this.highlight=function(a){a?(this.color.setRGB(1,1,0),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};m.prototype=Object.create(THREE.LineBasicMaterial.prototype);m.prototype.constructor=m;THREE.TransformGizmo=function(){var c=this;this.init=function(){THREE.Object3D.call(this);this.handles=new THREE.Object3D;this.pickers=new THREE.Object3D;
this.planes=new THREE.Object3D;this.add(this.handles);this.add(this.pickers);this.add(this.planes);var a=new THREE.PlaneBufferGeometry(50,50,2,2),c=new THREE.MeshBasicMaterial({wireframe:!0});c.side=THREE.DoubleSide;a={XY:new THREE.Mesh(a,c),YZ:new THREE.Mesh(a,c),XZ:new THREE.Mesh(a,c),XYZE:new THREE.Mesh(a,c)};this.activePlane=a.XYZE;a.YZ.rotation.set(0,Math.PI/2,0);a.XZ.rotation.set(-Math.PI/2,0,0);for(var f in a)a[f].name=f,this.planes.add(a[f]),this.planes[f]=a[f],a[f].visible=!1;a=function(a,
d){for(var c in a)for(f=a[c].length;f--;){var b=a[c][f][0],q=a[c][f][1],g=a[c][f][2];b.name=c;q&&b.position.set(q[0],q[1],q[2]);g&&b.rotation.set(g[0],g[1],g[2]);d.add(b)}};a(this.handleGizmos,this.handles);a(this.pickerGizmos,this.pickers);this.traverse(function(a){if(a instanceof THREE.Mesh){a.updateMatrix();var d=a.geometry.clone();d.applyMatrix(a.matrix);a.geometry=d;a.position.set(0,0,0);a.rotation.set(0,0,0);a.scale.set(1,1,1)}})};this.hide=function(){this.traverse(function(a){a.visible=!1})};
this.show=function(){this.traverse(function(a){a.visible=!0;a.parent==c.pickers&&(a.visible=!1);a.parent==c.planes&&(a.visible=!1)});this.activePlane.visible=!1};this.highlight=function(a){this.traverse(function(c){c.material&&c.material.highlight&&(c.name==a?c.material.highlight(!0):c.material.highlight(!1))})}};THREE.TransformGizmo.prototype=Object.create(THREE.Object3D.prototype);THREE.TransformGizmo.prototype.constructor=THREE.TransformGizmo;THREE.TransformGizmo.prototype.update=function(c,a){var q=
new THREE.Vector3(0,0,0),f=new THREE.Vector3(0,1,0),G=new THREE.Matrix4;this.traverse(function(d){-1!=d.name.search("E")?d.quaternion.setFromRotationMatrix(G.lookAt(a,q,f)):-1==d.name.search("X")&&-1==d.name.search("Y")&&-1==d.name.search("Z")||d.quaternion.setFromEuler(c)})};THREE.TransformGizmoTranslate=function(){THREE.TransformGizmo.call(this);var h=new THREE.Geometry,a=new THREE.Mesh(new THREE.CylinderGeometry(0,.05,.2,12,1,!1));a.position.y=.5;a.updateMatrix();h.merge(a.geometry,a.matrix);a=
new THREE.Geometry;a.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(1,0,0));var q=new THREE.Geometry;q.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,1,0));var f=new THREE.Geometry;f.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,1));this.handleGizmos={X:[[new THREE.Mesh(h,new c({color:16711680})),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(a,new m({color:16711680}))]],Y:[[new THREE.Mesh(h,new c({color:65280})),[0,.5,0]],[new THREE.Line(q,new m({color:65280}))]],
Z:[[new THREE.Mesh(h,new c({color:255})),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Line(f,new m({color:255}))]],XYZ:[[new THREE.Mesh(new THREE.OctahedronGeometry(.1,0),new c({color:16777215,opacity:.25})),[0,0,0],[0,0,0]]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new c({color:16776960,opacity:.25})),[.15,.15,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new c({color:65535,opacity:.25})),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,
.29),new c({color:16711935,opacity:.25})),[.15,0,.15],[-Math.PI/2,0,0]]]};this.pickerGizmos={X:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new c({color:16711680,opacity:.25})),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new c({color:65280,opacity:.25})),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new c({color:255,opacity:.25})),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.OctahedronGeometry(.2,0),
new c({color:16777215,opacity:.25}))]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),new c({color:16776960,opacity:.25})),[.2,.2,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),new c({color:65535,opacity:.25})),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),new c({color:16711935,opacity:.25})),[.2,0,.2],[-Math.PI/2,0,0]]]};this.setActivePlane=function(a,c){var f=new THREE.Matrix4;c.applyMatrix4(f.getInverse(f.extractRotation(this.planes.XY.matrixWorld)));
"X"==a&&(this.activePlane=this.planes.XY,Math.abs(c.y)>Math.abs(c.z)&&(this.activePlane=this.planes.XZ));"Y"==a&&(this.activePlane=this.planes.XY,Math.abs(c.x)>Math.abs(c.z)&&(this.activePlane=this.planes.YZ));"Z"==a&&(this.activePlane=this.planes.XZ,Math.abs(c.x)>Math.abs(c.y)&&(this.activePlane=this.planes.YZ));"XYZ"==a&&(this.activePlane=this.planes.XYZE);"XY"==a&&(this.activePlane=this.planes.XY);"YZ"==a&&(this.activePlane=this.planes.YZ);"XZ"==a&&(this.activePlane=this.planes.XZ);this.hide();
this.show()};this.init()};THREE.TransformGizmoTranslate.prototype=Object.create(THREE.TransformGizmo.prototype);THREE.TransformGizmoTranslate.prototype.constructor=THREE.TransformGizmoTranslate;THREE.TransformGizmoRotate=function(){THREE.TransformGizmo.call(this);var h=function(a,c,f){var h=new THREE.Geometry;f=f?f:1;for(var d=0;d<=64*f;++d)"x"==c&&h.vertices.push((new THREE.Vector3(0,Math.cos(d/32*Math.PI),Math.sin(d/32*Math.PI))).multiplyScalar(a)),"y"==c&&h.vertices.push((new THREE.Vector3(Math.cos(d/
32*Math.PI),0,Math.sin(d/32*Math.PI))).multiplyScalar(a)),"z"==c&&h.vertices.push((new THREE.Vector3(Math.sin(d/32*Math.PI),Math.cos(d/32*Math.PI),0)).multiplyScalar(a));return h};this.handleGizmos={X:[[new THREE.Line(new h(1,"x",.5),new m({color:16711680}))]],Y:[[new THREE.Line(new h(1,"y",.5),new m({color:65280}))]],Z:[[new THREE.Line(new h(1,"z",.5),new m({color:255}))]],E:[[new THREE.Line(new h(1.25,"z",1),new m({color:13421568}))]],XYZE:[[new THREE.Line(new h(1,"z",1),new m({color:7895160}))]]};
this.pickerGizmos={X:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),new c({color:16711680,opacity:.25})),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),new c({color:65280,opacity:.25})),[0,0,0],[Math.PI/2,0,0]]],Z:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),new c({color:255,opacity:.25})),[0,0,0],[0,0,-Math.PI/2]]],E:[[new THREE.Mesh(new THREE.TorusGeometry(1.25,.12,2,24),new c({color:16776960,opacity:.25}))]],XYZE:[[new THREE.Mesh(new THREE.Geometry)]]};
this.setActivePlane=function(a){"E"==a&&(this.activePlane=this.planes.XYZE);"X"==a&&(this.activePlane=this.planes.YZ);"Y"==a&&(this.activePlane=this.planes.XZ);"Z"==a&&(this.activePlane=this.planes.XY);this.hide();this.show()};this.update=function(a,c){THREE.TransformGizmo.prototype.update.apply(this,arguments);var f=new THREE.Matrix4,h=new THREE.Euler(0,0,1),d=new THREE.Quaternion,m=new THREE.Vector3(1,0,0),b=new THREE.Vector3(0,1,0),v=new THREE.Vector3(0,0,1),g=new THREE.Quaternion,w=new THREE.Quaternion,
I=new THREE.Quaternion,r=c.clone();h.copy(this.planes.XY.rotation);d.setFromEuler(h);f.makeRotationFromQuaternion(d).getInverse(f);r.applyMatrix4(f);this.traverse(function(a){d.setFromEuler(h);"X"==a.name&&(g.setFromAxisAngle(m,Math.atan2(-r.y,r.z)),d.multiplyQuaternions(d,g),a.quaternion.copy(d));"Y"==a.name&&(w.setFromAxisAngle(b,Math.atan2(r.x,r.z)),d.multiplyQuaternions(d,w),a.quaternion.copy(d));"Z"==a.name&&(I.setFromAxisAngle(v,Math.atan2(r.y,r.x)),d.multiplyQuaternions(d,I),a.quaternion.copy(d))})};
this.init()};THREE.TransformGizmoRotate.prototype=Object.create(THREE.TransformGizmo.prototype);THREE.TransformGizmoRotate.prototype.constructor=THREE.TransformGizmoRotate;THREE.TransformGizmoScale=function(){THREE.TransformGizmo.call(this);var h=new THREE.Geometry,a=new THREE.Mesh(new THREE.BoxGeometry(.125,.125,.125));a.position.y=.5;a.updateMatrix();h.merge(a.geometry,a.matrix);a=new THREE.Geometry;a.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(1,0,0));var q=new THREE.Geometry;q.vertices.push(new THREE.Vector3(0,
0,0),new THREE.Vector3(0,1,0));var f=new THREE.Geometry;f.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,1));this.handleGizmos={X:[[new THREE.Mesh(h,new c({color:16711680})),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(a,new m({color:16711680}))]],Y:[[new THREE.Mesh(h,new c({color:65280})),[0,.5,0]],[new THREE.Line(q,new m({color:65280}))]],Z:[[new THREE.Mesh(h,new c({color:255})),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Line(f,new m({color:255}))]],XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(.125,
.125,.125),new c({color:16777215,opacity:.25}))]]};this.pickerGizmos={X:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new c({color:16711680,opacity:.25})),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new c({color:65280,opacity:.25})),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new c({color:255,opacity:.25})),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(.4,.4,.4),new c({color:16777215,opacity:.25}))]]};
this.setActivePlane=function(a,c){var f=new THREE.Matrix4;c.applyMatrix4(f.getInverse(f.extractRotation(this.planes.XY.matrixWorld)));"X"==a&&(this.activePlane=this.planes.XY,Math.abs(c.y)>Math.abs(c.z)&&(this.activePlane=this.planes.XZ));"Y"==a&&(this.activePlane=this.planes.XY,Math.abs(c.x)>Math.abs(c.z)&&(this.activePlane=this.planes.YZ));"Z"==a&&(this.activePlane=this.planes.XZ,Math.abs(c.x)>Math.abs(c.y)&&(this.activePlane=this.planes.YZ));"XYZ"==a&&(this.activePlane=this.planes.XYZE);this.hide();
this.show()};this.init()};THREE.TransformGizmoScale.prototype=Object.create(THREE.TransformGizmo.prototype);THREE.TransformGizmoScale.prototype.constructor=THREE.TransformGizmoScale;THREE.TransformControls=function(c,a){function m(a){if(void 0!==b.object&&!0!==v){a.preventDefault();a=H(a.changedTouches?a.changedTouches[0]:a,b.gizmo[g].pickers.children);var c=null;a&&(c=a.object.name);b.axis!==c&&(b.axis=c,b.update(),b.dispatchEvent(w))}}function f(a){if(void 0!==b.object&&!0!==v){a.preventDefault();
a.stopPropagation();a=a.changedTouches?a.changedTouches[0]:a;if(0===a.button||void 0===a.button){var c=H(a,b.gizmo[g].pickers.children);c&&(b.dispatchEvent(I),b.axis=c.object.name,b.update(),B.copy(C).sub(z).normalize(),b.gizmo[g].setActivePlane(b.axis,B),a=H(a,[b.gizmo[g].activePlane]),N.copy(b.object.position),A.copy(b.object.scale),O.extractRotation(b.object.matrix),x.extractRotation(b.object.matrixWorld),E.extractRotation(b.object.parent.matrixWorld),F.setFromMatrixScale(p.getInverse(b.object.parent.matrixWorld)),
J.copy(a.point))}v=!0}}function G(a){if(void 0!==b.object&&null!==b.axis&&!1!==v){a.preventDefault();a.stopPropagation();a=H(a.changedTouches?a.changedTouches[0]:a,[b.gizmo[g].activePlane]);e.copy(a.point);if("translate"==g){e.sub(J);e.multiply(F);"local"==b.space&&(e.applyMatrix4(p.getInverse(x)),-1==b.axis.search("X")&&(e.x=0),-1==b.axis.search("Y")&&(e.y=0),-1==b.axis.search("Z")&&(e.z=0),e.applyMatrix4(O),b.object.position.copy(N),b.object.position.add(e));if("world"==b.space||-1!=b.axis.search("XYZ"))-1==
b.axis.search("X")&&(e.x=0),-1==b.axis.search("Y")&&(e.y=0),-1==b.axis.search("Z")&&(e.z=0),e.applyMatrix4(p.getInverse(E)),b.object.position.copy(N),b.object.position.add(e);null!==b.snap&&(-1!=b.axis.search("X")&&(b.object.position.x=Math.round(b.object.position.x/b.snap)*b.snap),-1!=b.axis.search("Y")&&(b.object.position.y=Math.round(b.object.position.y/b.snap)*b.snap),-1!=b.axis.search("Z")&&(b.object.position.z=Math.round(b.object.position.z/b.snap)*b.snap))}else"scale"==g?(e.sub(J),e.multiply(F),
"local"==b.space&&("XYZ"==b.axis?(y=1+e.y/50,b.object.scale.x=A.x*y,b.object.scale.y=A.y*y,b.object.scale.z=A.z*y):(e.applyMatrix4(p.getInverse(x)),"X"==b.axis&&(b.object.scale.x=A.x*(1+e.x/50)),"Y"==b.axis&&(b.object.scale.y=A.y*(1+e.y/50)),"Z"==b.axis&&(b.object.scale.z=A.z*(1+e.z/50))))):"rotate"==g&&(e.sub(z),e.multiply(F),k.copy(J).sub(z),k.multiply(F),"E"==b.axis?(e.applyMatrix4(p.getInverse(Q)),k.applyMatrix4(p.getInverse(Q)),t.set(Math.atan2(e.z,e.y),Math.atan2(e.x,e.z),Math.atan2(e.y,e.x)),
u.set(Math.atan2(k.z,k.y),Math.atan2(k.x,k.z),Math.atan2(k.y,k.x)),l.setFromRotationMatrix(p.getInverse(E)),K.setFromAxisAngle(B,t.z-u.z),n.setFromRotationMatrix(x),l.multiplyQuaternions(l,K),l.multiplyQuaternions(l,n),b.object.quaternion.copy(l)):"XYZE"==b.axis?(K.setFromEuler(e.clone().cross(k).normalize()),l.setFromRotationMatrix(p.getInverse(E)),D.setFromAxisAngle(K,-e.clone().angleTo(k)),n.setFromRotationMatrix(x),l.multiplyQuaternions(l,D),l.multiplyQuaternions(l,n),b.object.quaternion.copy(l)):
"local"==b.space?(e.applyMatrix4(p.getInverse(x)),k.applyMatrix4(p.getInverse(x)),t.set(Math.atan2(e.z,e.y),Math.atan2(e.x,e.z),Math.atan2(e.y,e.x)),u.set(Math.atan2(k.z,k.y),Math.atan2(k.x,k.z),Math.atan2(k.y,k.x)),n.setFromRotationMatrix(O),D.setFromAxisAngle(R,t.x-u.x),L.setFromAxisAngle(S,t.y-u.y),M.setFromAxisAngle(T,t.z-u.z),"X"==b.axis&&n.multiplyQuaternions(n,D),"Y"==b.axis&&n.multiplyQuaternions(n,L),"Z"==b.axis&&n.multiplyQuaternions(n,M),b.object.quaternion.copy(n)):"world"==b.space&&(t.set(Math.atan2(e.z,
e.y),Math.atan2(e.x,e.z),Math.atan2(e.y,e.x)),u.set(Math.atan2(k.z,k.y),Math.atan2(k.x,k.z),Math.atan2(k.y,k.x)),l.setFromRotationMatrix(p.getInverse(E)),D.setFromAxisAngle(R,t.x-u.x),L.setFromAxisAngle(S,t.y-u.y),M.setFromAxisAngle(T,t.z-u.z),n.setFromRotationMatrix(x),"X"==b.axis&&l.multiplyQuaternions(l,D),"Y"==b.axis&&l.multiplyQuaternions(l,L),"Z"==b.axis&&l.multiplyQuaternions(l,M),l.multiplyQuaternions(l,n),b.object.quaternion.copy(l)));b.update();b.dispatchEvent(w);b.dispatchEvent(W)}}function d(a){v&&
null!==b.axis&&(r.mode=g,b.dispatchEvent(r));v=!1;m(a)}function H(b,e){var d=a.getBoundingClientRect();P.set((b.clientX-d.left)/d.width*2-1,-((b.clientY-d.top)/d.height*2)+1,.5);P.unproject(c);U.set(C,P.sub(C).normalize());d=U.intersectObjects(e,!0);return d[0]?d[0]:!1}THREE.Object3D.call(this);a=void 0!==a?a:document;this.gizmo={};this.gizmo.translate=new THREE.TransformGizmoTranslate;this.gizmo.rotate=new THREE.TransformGizmoRotate;this.gizmo.scale=new THREE.TransformGizmoScale;this.add(this.gizmo.translate);
this.add(this.gizmo.rotate);this.add(this.gizmo.scale);this.gizmo.translate.hide();this.gizmo.rotate.hide();this.gizmo.scale.hide();this.object=void 0;this.snap=null;this.space="world";this.size=1;this.axis=null;var b=this,v=!1,g="translate",w={type:"change"},I={type:"mouseDown"},r={type:"mouseUp",mode:g},W={type:"objectChange"},U=new THREE.Raycaster,P=new THREE.Vector3,e=new THREE.Vector3,J=new THREE.Vector3,t=new THREE.Vector3,u=new THREE.Vector3,y=1,Q=new THREE.Matrix4,B=new THREE.Vector3,p=new THREE.Matrix4,
k=new THREE.Vector3,l=new THREE.Quaternion,R=new THREE.Vector3(1,0,0),S=new THREE.Vector3(0,1,0),T=new THREE.Vector3(0,0,1),n=new THREE.Quaternion,D=new THREE.Quaternion,L=new THREE.Quaternion,M=new THREE.Quaternion,K=new THREE.Quaternion,N=new THREE.Vector3,A=new THREE.Vector3,O=new THREE.Matrix4,E=new THREE.Matrix4,F=new THREE.Vector3,z=new THREE.Vector3,V=new THREE.Euler,x=new THREE.Matrix4,C=new THREE.Vector3,X=new THREE.Euler;a.addEventListener("mousedown",f,!1);a.addEventListener("touchstart",
f,!1);a.addEventListener("mousemove",m,!1);a.addEventListener("touchmove",m,!1);a.addEventListener("mousemove",G,!1);a.addEventListener("touchmove",G,!1);a.addEventListener("mouseup",d,!1);a.addEventListener("mouseout",d,!1);a.addEventListener("touchend",d,!1);a.addEventListener("touchcancel",d,!1);a.addEventListener("touchleave",d,!1);this.attach=function(a){b.object=a;this.gizmo.translate.hide();this.gizmo.rotate.hide();this.gizmo.scale.hide();this.gizmo[g].show();b.update()};this.detach=function(a){b.object=
void 0;this.axis=null;this.gizmo.translate.hide();this.gizmo.rotate.hide();this.gizmo.scale.hide()};this.setMode=function(a){g=a?a:g;"scale"==g&&(b.space="local");this.gizmo.translate.hide();this.gizmo.rotate.hide();this.gizmo.scale.hide();this.gizmo[g].show();this.update();b.dispatchEvent(w)};this.setSnap=function(a){b.snap=a};this.setSize=function(a){b.size=a;this.update();b.dispatchEvent(w)};this.setSpace=function(a){b.space=a;this.update();b.dispatchEvent(w)};this.update=function(){void 0!==b.object&&
(b.object.updateMatrixWorld(),z.setFromMatrixPosition(b.object.matrixWorld),V.setFromRotationMatrix(p.extractRotation(b.object.matrixWorld)),c.updateMatrixWorld(),C.setFromMatrixPosition(c.matrixWorld),X.setFromRotationMatrix(p.extractRotation(c.matrixWorld)),y=z.distanceTo(C)/6*b.size,this.position.copy(z),this.scale.set(y,y,y),B.copy(C).sub(z).normalize(),"local"==b.space?this.gizmo[g].update(V,B):"world"==b.space&&this.gizmo[g].update(new THREE.Euler,B),this.gizmo[g].highlight(b.axis))}};THREE.TransformControls.prototype=
Object.create(THREE.Object3D.prototype);THREE.TransformControls.prototype.constructor=THREE.TransformControls})();