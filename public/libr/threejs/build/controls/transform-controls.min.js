!function(){"use strict";var a=function(a){THREE.MeshBasicMaterial.call(this),this.depthTest=!1,this.depthWrite=!1,this.side=THREE.FrontSide,this.transparent=!0,this.setValues(a),this.oldColor=this.color.clone(),this.oldOpacity=this.opacity,this.highlight=function(a){a?(this.color.setRGB(1,1,0),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};a.prototype=Object.create(THREE.MeshBasicMaterial.prototype),a.prototype.constructor=a;var b=function(a){THREE.LineBasicMaterial.call(this),this.depthTest=!1,this.depthWrite=!1,this.transparent=!0,this.linewidth=1,this.setValues(a),this.oldColor=this.color.clone(),this.oldOpacity=this.opacity,this.highlight=function(a){a?(this.color.setRGB(1,1,0),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};b.prototype=Object.create(THREE.LineBasicMaterial.prototype),b.prototype.constructor=b,THREE.TransformGizmo=function(){var a=this,b=!1,c=!1;this.init=function(){THREE.Object3D.call(this),this.handles=new THREE.Object3D,this.pickers=new THREE.Object3D,this.planes=new THREE.Object3D,this.add(this.handles),this.add(this.pickers),this.add(this.planes);var a=new THREE.PlaneBufferGeometry(50,50,2,2),b=new THREE.MeshBasicMaterial({wireframe:!0});b.side=THREE.DoubleSide;var c={XY:new THREE.Mesh(a,b),YZ:new THREE.Mesh(a,b),XZ:new THREE.Mesh(a,b),XYZE:new THREE.Mesh(a,b)};this.activePlane=c.XYZE,c.YZ.rotation.set(0,Math.PI/2,0),c.XZ.rotation.set(-Math.PI/2,0,0);for(var d in c)c[d].name=d,this.planes.add(c[d]),this.planes[d]=c[d],c[d].visible=!1;var e=function(a,b){for(var c in a)for(d=a[c].length;d--;){var e=a[c][d][0],f=a[c][d][1],g=a[c][d][2];e.name=c,f&&e.position.set(f[0],f[1],f[2]),g&&e.rotation.set(g[0],g[1],g[2]),b.add(e)}};e(this.handleGizmos,this.handles),e(this.pickerGizmos,this.pickers),this.traverse(function(a){if(a instanceof THREE.Mesh){a.updateMatrix();var b=a.geometry.clone();b.applyMatrix(a.matrix),a.geometry=b,a.position.set(0,0,0),a.rotation.set(0,0,0),a.scale.set(1,1,1)}})},this.hide=function(){this.traverse(function(a){a.visible=!1})},this.show=function(){this.traverse(function(c){c.visible=!0,c.parent==a.pickers&&(c.visible=b),c.parent==a.planes&&(c.visible=!1)}),this.activePlane.visible=c},this.highlight=function(a){this.traverse(function(b){b.material&&b.material.highlight&&(b.name==a?b.material.highlight(!0):b.material.highlight(!1))})}},THREE.TransformGizmo.prototype=Object.create(THREE.Object3D.prototype),THREE.TransformGizmo.prototype.constructor=THREE.TransformGizmo,THREE.TransformGizmo.prototype.update=function(a,b){var c=new THREE.Vector3(0,0,0),d=new THREE.Vector3(0,1,0),e=new THREE.Matrix4;this.traverse(function(f){-1!=f.name.search("E")?f.quaternion.setFromRotationMatrix(e.lookAt(b,c,d)):(-1!=f.name.search("X")||-1!=f.name.search("Y")||-1!=f.name.search("Z"))&&f.quaternion.setFromEuler(a)})},THREE.TransformGizmoTranslate=function(){THREE.TransformGizmo.call(this);var c=new THREE.Geometry,d=new THREE.Mesh(new THREE.CylinderGeometry(0,.05,.2,12,1,!1));d.position.y=.5,d.updateMatrix(),c.merge(d.geometry,d.matrix);var e=new THREE.Geometry;e.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(1,0,0));var f=new THREE.Geometry;f.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,1,0));var g=new THREE.Geometry;g.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,1)),this.handleGizmos={X:[[new THREE.Mesh(c,new a({color:16711680})),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(e,new b({color:16711680}))]],Y:[[new THREE.Mesh(c,new a({color:65280})),[0,.5,0]],[new THREE.Line(f,new b({color:65280}))]],Z:[[new THREE.Mesh(c,new a({color:255})),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Line(g,new b({color:255}))]],XYZ:[[new THREE.Mesh(new THREE.OctahedronGeometry(.1,0),new a({color:16777215,opacity:.25})),[0,0,0],[0,0,0]]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new a({color:16776960,opacity:.25})),[.15,.15,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new a({color:65535,opacity:.25})),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new a({color:16711935,opacity:.25})),[.15,0,.15],[-Math.PI/2,0,0]]]},this.pickerGizmos={X:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new a({color:16711680,opacity:.25})),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new a({color:65280,opacity:.25})),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new a({color:255,opacity:.25})),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.OctahedronGeometry(.2,0),new a({color:16777215,opacity:.25}))]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),new a({color:16776960,opacity:.25})),[.2,.2,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),new a({color:65535,opacity:.25})),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),new a({color:16711935,opacity:.25})),[.2,0,.2],[-Math.PI/2,0,0]]]},this.setActivePlane=function(a,b){var c=new THREE.Matrix4;b.applyMatrix4(c.getInverse(c.extractRotation(this.planes.XY.matrixWorld))),"X"==a&&(this.activePlane=this.planes.XY,Math.abs(b.y)>Math.abs(b.z)&&(this.activePlane=this.planes.XZ)),"Y"==a&&(this.activePlane=this.planes.XY,Math.abs(b.x)>Math.abs(b.z)&&(this.activePlane=this.planes.YZ)),"Z"==a&&(this.activePlane=this.planes.XZ,Math.abs(b.x)>Math.abs(b.y)&&(this.activePlane=this.planes.YZ)),"XYZ"==a&&(this.activePlane=this.planes.XYZE),"XY"==a&&(this.activePlane=this.planes.XY),"YZ"==a&&(this.activePlane=this.planes.YZ),"XZ"==a&&(this.activePlane=this.planes.XZ),this.hide(),this.show()},this.init()},THREE.TransformGizmoTranslate.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformGizmoTranslate.prototype.constructor=THREE.TransformGizmoTranslate,THREE.TransformGizmoRotate=function(){THREE.TransformGizmo.call(this);var c=function(a,b,c){var d=new THREE.Geometry;c=c?c:1;for(var e=0;64*c>=e;++e)"x"==b&&d.vertices.push(new THREE.Vector3(0,Math.cos(e/32*Math.PI),Math.sin(e/32*Math.PI)).multiplyScalar(a)),"y"==b&&d.vertices.push(new THREE.Vector3(Math.cos(e/32*Math.PI),0,Math.sin(e/32*Math.PI)).multiplyScalar(a)),"z"==b&&d.vertices.push(new THREE.Vector3(Math.sin(e/32*Math.PI),Math.cos(e/32*Math.PI),0).multiplyScalar(a));return d};this.handleGizmos={X:[[new THREE.Line(new c(1,"x",.5),new b({color:16711680}))]],Y:[[new THREE.Line(new c(1,"y",.5),new b({color:65280}))]],Z:[[new THREE.Line(new c(1,"z",.5),new b({color:255}))]],E:[[new THREE.Line(new c(1.25,"z",1),new b({color:13421568}))]],XYZE:[[new THREE.Line(new c(1,"z",1),new b({color:7895160}))]]},this.pickerGizmos={X:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),new a({color:16711680,opacity:.25})),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),new a({color:65280,opacity:.25})),[0,0,0],[Math.PI/2,0,0]]],Z:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),new a({color:255,opacity:.25})),[0,0,0],[0,0,-Math.PI/2]]],E:[[new THREE.Mesh(new THREE.TorusGeometry(1.25,.12,2,24),new a({color:16776960,opacity:.25}))]],XYZE:[[new THREE.Mesh(new THREE.Geometry)]]},this.setActivePlane=function(a){"E"==a&&(this.activePlane=this.planes.XYZE),"X"==a&&(this.activePlane=this.planes.YZ),"Y"==a&&(this.activePlane=this.planes.XZ),"Z"==a&&(this.activePlane=this.planes.XY),this.hide(),this.show()},this.update=function(a,b){THREE.TransformGizmo.prototype.update.apply(this,arguments),{handles:this.handles,pickers:this.pickers};var d=new THREE.Matrix4,e=new THREE.Euler(0,0,1),f=new THREE.Quaternion,g=new THREE.Vector3(1,0,0),h=new THREE.Vector3(0,1,0),i=new THREE.Vector3(0,0,1),j=new THREE.Quaternion,k=new THREE.Quaternion,l=new THREE.Quaternion,m=b.clone();e.copy(this.planes.XY.rotation),f.setFromEuler(e),d.makeRotationFromQuaternion(f).getInverse(d),m.applyMatrix4(d),this.traverse(function(a){f.setFromEuler(e),"X"==a.name&&(j.setFromAxisAngle(g,Math.atan2(-m.y,m.z)),f.multiplyQuaternions(f,j),a.quaternion.copy(f)),"Y"==a.name&&(k.setFromAxisAngle(h,Math.atan2(m.x,m.z)),f.multiplyQuaternions(f,k),a.quaternion.copy(f)),"Z"==a.name&&(l.setFromAxisAngle(i,Math.atan2(m.y,m.x)),f.multiplyQuaternions(f,l),a.quaternion.copy(f))})},this.init()},THREE.TransformGizmoRotate.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformGizmoRotate.prototype.constructor=THREE.TransformGizmoRotate,THREE.TransformGizmoScale=function(){THREE.TransformGizmo.call(this);var c=new THREE.Geometry,d=new THREE.Mesh(new THREE.BoxGeometry(.125,.125,.125));d.position.y=.5,d.updateMatrix(),c.merge(d.geometry,d.matrix);var e=new THREE.Geometry;e.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(1,0,0));var f=new THREE.Geometry;f.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,1,0));var g=new THREE.Geometry;g.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,1)),this.handleGizmos={X:[[new THREE.Mesh(c,new a({color:16711680})),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(e,new b({color:16711680}))]],Y:[[new THREE.Mesh(c,new a({color:65280})),[0,.5,0]],[new THREE.Line(f,new b({color:65280}))]],Z:[[new THREE.Mesh(c,new a({color:255})),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Line(g,new b({color:255}))]],XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(.125,.125,.125),new a({color:16777215,opacity:.25}))]]},this.pickerGizmos={X:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new a({color:16711680,opacity:.25})),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new a({color:65280,opacity:.25})),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new a({color:255,opacity:.25})),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(.4,.4,.4),new a({color:16777215,opacity:.25}))]]},this.setActivePlane=function(a,b){var c=new THREE.Matrix4;b.applyMatrix4(c.getInverse(c.extractRotation(this.planes.XY.matrixWorld))),"X"==a&&(this.activePlane=this.planes.XY,Math.abs(b.y)>Math.abs(b.z)&&(this.activePlane=this.planes.XZ)),"Y"==a&&(this.activePlane=this.planes.XY,Math.abs(b.x)>Math.abs(b.z)&&(this.activePlane=this.planes.YZ)),"Z"==a&&(this.activePlane=this.planes.XZ,Math.abs(b.x)>Math.abs(b.y)&&(this.activePlane=this.planes.YZ)),"XYZ"==a&&(this.activePlane=this.planes.XYZE),this.hide(),this.show()},this.init()},THREE.TransformGizmoScale.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformGizmoScale.prototype.constructor=THREE.TransformGizmoScale,THREE.TransformControls=function(a,b){function O(a){if(void 0!==c.object&&d!==!0){a.preventDefault();var b=a.changedTouches?a.changedTouches[0]:a,f=S(b,c.gizmo[e].pickers.children),h=null;f&&(h=f.object.name),c.axis!==h&&(c.axis=h,c.update(),c.dispatchEvent(g))}}function P(a){if(void 0!==c.object&&d!==!0){a.preventDefault(),a.stopPropagation();var b=a.changedTouches?a.changedTouches[0]:a;if(0===b.button||void 0===b.button){var f=S(b,c.gizmo[e].pickers.children);if(f){c.dispatchEvent(h),c.axis=f.object.name,c.update(),s.copy(M).sub(J).normalize(),c.gizmo[e].setActivePlane(c.axis,s);var g=S(b,[c.gizmo[e].activePlane]);E.copy(c.object.position),F.copy(c.object.scale),G.extractRotation(c.object.matrix),L.extractRotation(c.object.matrixWorld),H.extractRotation(c.object.parent.matrixWorld),I.setFromMatrixScale(t.getInverse(c.object.parent.matrixWorld)),n.copy(g.point)}}d=!0}}function Q(a){if(void 0!==c.object&&null!==c.axis&&d!==!1){a.preventDefault(),a.stopPropagation();var b=a.changedTouches?a.changedTouches[0]:a,f=S(b,[c.gizmo[e].activePlane]);m.copy(f.point),"translate"==e?(m.sub(n),m.multiply(I),"local"==c.space&&(m.applyMatrix4(t.getInverse(L)),-1==c.axis.search("X")&&(m.x=0),-1==c.axis.search("Y")&&(m.y=0),-1==c.axis.search("Z")&&(m.z=0),m.applyMatrix4(G),c.object.position.copy(E),c.object.position.add(m)),("world"==c.space||-1!=c.axis.search("XYZ"))&&(-1==c.axis.search("X")&&(m.x=0),-1==c.axis.search("Y")&&(m.y=0),-1==c.axis.search("Z")&&(m.z=0),m.applyMatrix4(t.getInverse(H)),c.object.position.copy(E),c.object.position.add(m)),null!==c.snap&&(-1!=c.axis.search("X")&&(c.object.position.x=Math.round(c.object.position.x/c.snap)*c.snap),-1!=c.axis.search("Y")&&(c.object.position.y=Math.round(c.object.position.y/c.snap)*c.snap),-1!=c.axis.search("Z")&&(c.object.position.z=Math.round(c.object.position.z/c.snap)*c.snap))):"scale"==e?(m.sub(n),m.multiply(I),"local"==c.space&&("XYZ"==c.axis?(q=1+m.y/50,c.object.scale.x=F.x*q,c.object.scale.y=F.y*q,c.object.scale.z=F.z*q):(m.applyMatrix4(t.getInverse(L)),"X"==c.axis&&(c.object.scale.x=F.x*(1+m.x/50)),"Y"==c.axis&&(c.object.scale.y=F.y*(1+m.y/50)),"Z"==c.axis&&(c.object.scale.z=F.z*(1+m.z/50))))):"rotate"==e&&(m.sub(J),m.multiply(I),u.copy(n).sub(J),u.multiply(I),"E"==c.axis?(m.applyMatrix4(t.getInverse(r)),u.applyMatrix4(t.getInverse(r)),o.set(Math.atan2(m.z,m.y),Math.atan2(m.x,m.z),Math.atan2(m.y,m.x)),p.set(Math.atan2(u.z,u.y),Math.atan2(u.x,u.z),Math.atan2(u.y,u.x)),v.setFromRotationMatrix(t.getInverse(H)),D.setFromAxisAngle(s,o.z-p.z),z.setFromRotationMatrix(L),v.multiplyQuaternions(v,D),v.multiplyQuaternions(v,z),c.object.quaternion.copy(v)):"XYZE"==c.axis?(D.setFromEuler(m.clone().cross(u).normalize()),v.setFromRotationMatrix(t.getInverse(H)),A.setFromAxisAngle(D,-m.clone().angleTo(u)),z.setFromRotationMatrix(L),v.multiplyQuaternions(v,A),v.multiplyQuaternions(v,z),c.object.quaternion.copy(v)):"local"==c.space?(m.applyMatrix4(t.getInverse(L)),u.applyMatrix4(t.getInverse(L)),o.set(Math.atan2(m.z,m.y),Math.atan2(m.x,m.z),Math.atan2(m.y,m.x)),p.set(Math.atan2(u.z,u.y),Math.atan2(u.x,u.z),Math.atan2(u.y,u.x)),z.setFromRotationMatrix(G),A.setFromAxisAngle(w,o.x-p.x),B.setFromAxisAngle(x,o.y-p.y),C.setFromAxisAngle(y,o.z-p.z),"X"==c.axis&&z.multiplyQuaternions(z,A),"Y"==c.axis&&z.multiplyQuaternions(z,B),"Z"==c.axis&&z.multiplyQuaternions(z,C),c.object.quaternion.copy(z)):"world"==c.space&&(o.set(Math.atan2(m.z,m.y),Math.atan2(m.x,m.z),Math.atan2(m.y,m.x)),p.set(Math.atan2(u.z,u.y),Math.atan2(u.x,u.z),Math.atan2(u.y,u.x)),v.setFromRotationMatrix(t.getInverse(H)),A.setFromAxisAngle(w,o.x-p.x),B.setFromAxisAngle(x,o.y-p.y),C.setFromAxisAngle(y,o.z-p.z),z.setFromRotationMatrix(L),"X"==c.axis&&v.multiplyQuaternions(v,A),"Y"==c.axis&&v.multiplyQuaternions(v,B),"Z"==c.axis&&v.multiplyQuaternions(v,C),v.multiplyQuaternions(v,z),c.object.quaternion.copy(v))),c.update(),c.dispatchEvent(g),c.dispatchEvent(j)}}function R(a){d&&null!==c.axis&&(i.mode=e,c.dispatchEvent(i)),d=!1,O(a)}function S(c,d){var e=b.getBoundingClientRect(),f=(c.clientX-e.left)/e.width,g=(c.clientY-e.top)/e.height;l.set(2*f-1,-(2*g)+1,.5),l.unproject(a),k.set(M,l.sub(M).normalize());var h=k.intersectObjects(d,!0);return h[0]?h[0]:!1}THREE.Object3D.call(this),b=void 0!==b?b:document,this.gizmo={},this.gizmo.translate=new THREE.TransformGizmoTranslate,this.gizmo.rotate=new THREE.TransformGizmoRotate,this.gizmo.scale=new THREE.TransformGizmoScale,this.add(this.gizmo.translate),this.add(this.gizmo.rotate),this.add(this.gizmo.scale),this.gizmo.translate.hide(),this.gizmo.rotate.hide(),this.gizmo.scale.hide(),this.object=void 0,this.snap=null,this.space="world",this.size=1,this.axis=null;var c=this,d=!1,e="translate",g={type:"change"},h={type:"mouseDown"},i={type:"mouseUp",mode:e},j={type:"objectChange"},k=new THREE.Raycaster,l=new THREE.Vector3,m=new THREE.Vector3,n=new THREE.Vector3,o=new THREE.Vector3,p=new THREE.Vector3,q=1,r=new THREE.Matrix4,s=new THREE.Vector3,t=new THREE.Matrix4,u=new THREE.Vector3,v=new THREE.Quaternion,w=new THREE.Vector3(1,0,0),x=new THREE.Vector3(0,1,0),y=new THREE.Vector3(0,0,1),z=new THREE.Quaternion,A=new THREE.Quaternion,B=new THREE.Quaternion,C=new THREE.Quaternion,D=new THREE.Quaternion,E=new THREE.Vector3,F=new THREE.Vector3,G=new THREE.Matrix4,H=new THREE.Matrix4,I=new THREE.Vector3,J=new THREE.Vector3,K=new THREE.Euler,L=new THREE.Matrix4,M=new THREE.Vector3,N=new THREE.Euler;b.addEventListener("mousedown",P,!1),b.addEventListener("touchstart",P,!1),b.addEventListener("mousemove",O,!1),b.addEventListener("touchmove",O,!1),b.addEventListener("mousemove",Q,!1),b.addEventListener("touchmove",Q,!1),b.addEventListener("mouseup",R,!1),b.addEventListener("mouseout",R,!1),b.addEventListener("touchend",R,!1),b.addEventListener("touchcancel",R,!1),b.addEventListener("touchleave",R,!1),this.attach=function(a){c.object=a,this.gizmo.translate.hide(),this.gizmo.rotate.hide(),this.gizmo.scale.hide(),this.gizmo[e].show(),c.update()},this.detach=function(){c.object=void 0,this.axis=null,this.gizmo.translate.hide(),this.gizmo.rotate.hide(),this.gizmo.scale.hide()},this.setMode=function(a){e=a?a:e,"scale"==e&&(c.space="local"),this.gizmo.translate.hide(),this.gizmo.rotate.hide(),this.gizmo.scale.hide(),this.gizmo[e].show(),this.update(),c.dispatchEvent(g)},this.setSnap=function(a){c.snap=a},this.setSize=function(a){c.size=a,this.update(),c.dispatchEvent(g)},this.setSpace=function(a){c.space=a,this.update(),c.dispatchEvent(g)},this.update=function(){if(void 0!==c.object){if(c.object.updateMatrixWorld(),J.setFromMatrixPosition(c.object.matrixWorld),K.setFromRotationMatrix(t.extractRotation(c.object.matrixWorld)),a.updateMatrixWorld(),M.setFromMatrixPosition(a.matrixWorld),N.setFromRotationMatrix(t.extractRotation(a.matrixWorld)),q=J.distanceTo(M)/16*c.size,c.object.origin){var b=new THREE.Vector3;b.copy(c.object.origin).add(J),this.position.copy(b)}this.scale.set(q,q,q),s.copy(M).sub(J).normalize(),"local"==c.space?this.gizmo[e].update(K,s):"world"==c.space&&this.gizmo[e].update(new THREE.Euler,s),this.gizmo[e].highlight(c.axis)}}},THREE.TransformControls.prototype=Object.create(THREE.Object3D.prototype),THREE.TransformControls.prototype.constructor=THREE.TransformControls}();
