THREE.TrackballControls=function(a,b){function y(a){c.enabled!==!1&&(window.removeEventListener("keydown",y),h=g,g===d.NONE&&(a.keyCode!==c.keys[d.ROTATE]||c.noRotate?a.keyCode!==c.keys[d.ZOOM]||c.noZoom?a.keyCode!==c.keys[d.PAN]||c.noPan||(g=d.PAN):g=d.ZOOM:g=d.ROTATE))}function z(){c.enabled!==!1&&(g=h,window.addEventListener("keydown",y,!1))}function A(a){c.enabled!==!1&&(a.preventDefault(),a.stopPropagation(),g===d.NONE&&(g=a.button),g!==d.ROTATE||c.noRotate?g!==d.ZOOM||c.noZoom?g!==d.PAN||c.noPan||(r.copy(w(a.pageX,a.pageY)),s.copy(r)):(n.copy(w(a.pageX,a.pageY)),o.copy(n)):(k.copy(x(a.pageX,a.pageY)),j.copy(k)),document.addEventListener("mousemove",B,!1),document.addEventListener("mouseup",C,!1),c.dispatchEvent(u))}function B(a){c.enabled!==!1&&(a.preventDefault(),a.stopPropagation(),g!==d.ROTATE||c.noRotate?g!==d.ZOOM||c.noZoom?g!==d.PAN||c.noPan||s.copy(w(a.pageX,a.pageY)):o.copy(w(a.pageX,a.pageY)):(j.copy(k),k.copy(x(a.pageX,a.pageY))))}function C(a){c.enabled!==!1&&(a.preventDefault(),a.stopPropagation(),g=d.NONE,document.removeEventListener("mousemove",B),document.removeEventListener("mouseup",C),c.dispatchEvent(v))}function D(a){if(c.enabled!==!1){a.preventDefault(),a.stopPropagation();var b=0;a.wheelDelta?b=a.wheelDelta/40:a.detail&&(b=-a.detail/3),n.y+=.01*b,c.dispatchEvent(u),c.dispatchEvent(v)}}function E(a){if(c.enabled!==!1){switch(a.touches.length){case 1:g=d.TOUCH_ROTATE,k.copy(x(a.touches[0].pageX,a.touches[0].pageY)),j.copy(k);break;case 2:g=d.TOUCH_ZOOM_PAN;var b=a.touches[0].pageX-a.touches[1].pageX,e=a.touches[0].pageY-a.touches[1].pageY;q=p=Math.sqrt(b*b+e*e);var f=(a.touches[0].pageX+a.touches[1].pageX)/2,h=(a.touches[0].pageY+a.touches[1].pageY)/2;r.copy(w(f,h)),s.copy(r);break;default:g=d.NONE}c.dispatchEvent(u)}}function F(a){if(c.enabled!==!1)switch(a.preventDefault(),a.stopPropagation(),a.touches.length){case 1:j.copy(k),k.copy(x(a.touches[0].pageX,a.touches[0].pageY));break;case 2:var b=a.touches[0].pageX-a.touches[1].pageX,e=a.touches[0].pageY-a.touches[1].pageY;q=Math.sqrt(b*b+e*e);var f=(a.touches[0].pageX+a.touches[1].pageX)/2,h=(a.touches[0].pageY+a.touches[1].pageY)/2;s.copy(w(f,h));break;default:g=d.NONE}}function G(a){if(c.enabled!==!1){switch(a.touches.length){case 1:j.copy(k),k.copy(x(a.touches[0].pageX,a.touches[0].pageY));break;case 2:p=q=0;var b=(a.touches[0].pageX+a.touches[1].pageX)/2,e=(a.touches[0].pageY+a.touches[1].pageY)/2;s.copy(w(b,e)),r.copy(s)}g=d.NONE,c.dispatchEvent(v)}}var c=this,d={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=a,this.domElement=void 0!==b?b:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.target=new THREE.Vector3;var e=1e-6,f=new THREE.Vector3,g=d.NONE,h=d.NONE,i=new THREE.Vector3,j=new THREE.Vector2,k=new THREE.Vector2,l=new THREE.Vector3,m=0,n=new THREE.Vector2,o=new THREE.Vector2,p=0,q=0,r=new THREE.Vector2,s=new THREE.Vector2;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone();var t={type:"change"},u={type:"start"},v={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var a=this.domElement.getBoundingClientRect(),b=this.domElement.ownerDocument.documentElement;this.screen.left=a.left+window.pageXOffset-b.clientLeft,this.screen.top=a.top+window.pageYOffset-b.clientTop,this.screen.width=a.width,this.screen.height=a.height}},this.handleEvent=function(a){"function"==typeof this[a.type]&&this[a.type](a)};var w=function(){var a=new THREE.Vector2;return function(b,d){return a.set((b-c.screen.left)/c.screen.width,(d-c.screen.top)/c.screen.height),a}}(),x=function(){var a=new THREE.Vector2;return function(b,d){return a.set((b-.5*c.screen.width-c.screen.left)/(.5*c.screen.width),(c.screen.height+2*(c.screen.top-d))/c.screen.width),a}}();this.rotateCamera=function(){var h,a=new THREE.Vector3,b=new THREE.Quaternion,d=new THREE.Vector3,e=new THREE.Vector3,f=new THREE.Vector3,g=new THREE.Vector3;return function(){g.set(k.x-j.x,k.y-j.y,0),h=g.length(),h?(i.copy(c.object.position).sub(c.target),d.copy(i).normalize(),e.copy(c.object.up).normalize(),f.crossVectors(e,d).normalize(),e.setLength(k.y-j.y),f.setLength(k.x-j.x),g.copy(e.add(f)),a.crossVectors(g,i).normalize(),h*=c.rotateSpeed,b.setFromAxisAngle(a,h),i.applyQuaternion(b),c.object.up.applyQuaternion(b),l.copy(a),m=h):!c.staticMoving&&m&&(m*=Math.sqrt(1-c.dynamicDampingFactor),i.copy(c.object.position).sub(c.target),b.setFromAxisAngle(l,m),i.applyQuaternion(b),c.object.up.applyQuaternion(b)),j.copy(k)}}(),this.zoomCamera=function(){var a;g===d.TOUCH_ZOOM_PAN?(a=p/q,p=q,i.multiplyScalar(a)):(a=1+(o.y-n.y)*c.zoomSpeed,1!==a&&a>0&&(i.multiplyScalar(a),c.staticMoving?n.copy(o):n.y+=(o.y-n.y)*this.dynamicDampingFactor))},this.panCamera=function(){var a=new THREE.Vector2,b=new THREE.Vector3,d=new THREE.Vector3;return function(){a.copy(s).sub(r),a.lengthSq()&&(a.multiplyScalar(i.length()*c.panSpeed),d.copy(i).cross(c.object.up).setLength(a.x),d.add(b.copy(c.object.up).setLength(a.y)),c.object.position.add(d),c.target.add(d),c.staticMoving?r.copy(s):r.add(a.subVectors(s,r).multiplyScalar(c.dynamicDampingFactor)))}}(),this.checkDistances=function(){c.noZoom&&c.noPan||(i.lengthSq()>c.maxDistance*c.maxDistance&&c.object.position.addVectors(c.target,i.setLength(c.maxDistance)),i.lengthSq()<c.minDistance*c.minDistance&&c.object.position.addVectors(c.target,i.setLength(c.minDistance)))},this.update=function(){i.subVectors(c.object.position,c.target),c.noRotate||c.rotateCamera(),c.noZoom||c.zoomCamera(),c.noPan||c.panCamera(),c.object.position.addVectors(c.target,i),c.checkDistances(),c.object.lookAt(c.target),f.distanceToSquared(c.object.position)>e&&(c.dispatchEvent(t),f.copy(c.object.position))},this.reset=function(){g=d.NONE,h=d.NONE,c.target.copy(c.target0),c.object.position.copy(c.position0),c.object.up.copy(c.up0),i.subVectors(c.object.position,c.target),c.object.lookAt(c.target),c.dispatchEvent(t),f.copy(c.object.position)},this.domElement.addEventListener("contextmenu",function(a){a.preventDefault()},!1),this.domElement.addEventListener("mousedown",A,!1),this.domElement.addEventListener("mousewheel",D,!1),this.domElement.addEventListener("DOMMouseScroll",D,!1),this.domElement.addEventListener("touchstart",E,!1),this.domElement.addEventListener("touchend",G,!1),this.domElement.addEventListener("touchmove",F,!1),window.addEventListener("keydown",y,!1),window.addEventListener("keyup",z,!1),this.handleResize(),this.update()},THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.TrackballControls.prototype.constructor=THREE.TrackballControls;